#!/usr/bin/emacs --script

;;; ecukes-init --- Initialization script for Ecukes

;; Creates Ecukes file structure for current directory.
;; 
;; Files creates:
;;   - features
;;     - step-definitions
;;       - project-steps.el
;;     - support.el
;;     - project.feature
;; 
;; Usage:
;;   $ cd /path/to/my/project
;;   $ ecukes-init

(let* ((features (expand-file-name "features"))
       (project-name (file-name-nondirectory (expand-file-name "."))))

  (if (file-directory-p features)
      (message "features already exist!")
    (progn
      ;; Create directory "features"
      (make-directory features)

      (let ((step-definitions (expand-file-name "step-definitions" features)))
        ;; Create directory "features/step-definitions"
        (make-directory step-definitions)
        ;; Create file "features/step-definitions/project-steps.el"
        (write-file (expand-file-name (concat project-name "-steps.el") step-definitions)))

      ;; Create file "features/project.feature"
      (write-file (expand-file-name (concat project-name ".feature") features))

      ;; Create file "features/support.el"
      (with-temp-file (expand-file-name "support.el" features)
        (insert
         (concat
          "(add-to-list 'load-path \"/path/to/" project-name "\")\n"
          "(require '" project-name ")\n\n"

          "(add-to-list 'load-path \"/path/to/espuds\")\n"
          "(require 'espuds)\n")))
      (message (concat "Successfully initialized Ecukes for " project-name)))))
